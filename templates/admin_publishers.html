{% extends "base.html" %}
{% block title %}
Admin - Publishers
{% endblock title %}
{% block head %}
{% endblock head %}
{% block content %}
<div class="mx-4 mt-4 flex w-full">
    <button class="self-start text-white font-bold bg-[#069] hover:bg-[#005580] cursor-pointer focus:ring-4 focus:outline-hidden focus:ring-blue-300 rounded-lg text-sm px-5 py-2.5 text-center" onclick="setDialogValues(null)">{{ _('Neuer Verlag') }}</button>
    <form action="{{ url_for('admin_export_publishers_as_json') }}">
        <button type="submit" class="ml-32 flex items-center text-center text-white font-bold bg-[#069] hover:bg-[#005580] cursor-pointer focus:ring-4 focus:outline-hidden focus:ring-blue-300 rounded-lg text-sm px-5 py-2.5">
            <span class="flex h-5 w-5 icon-[vscode-icons--file-type-json] mr-2"></span>{{ _("Export as JSON")}}
        </button>
    </form>
</div>
<div class="h-full mx-4 mt-4 text-sm text-left text-black overflow-x-auto">
    <div class="grid grid-cols-5 py-4 pl-2 text-xs font-bold text-white uppercase justify-items-start items-center bg-gray-800 px-3">
        <div class="col-span-2">{{ gettext("Name") }}</div>
        <div>{{ gettext("Gültigkeit") }}</div>
        <div>{{ gettext("OA-Status") }}</div>
    </div>
    {% for p in g.publishers %}
    <div id="{{ p.id }}" class="grid grid-cols-5 justify-items-start items-center odd:bg-gray-200 even:bg-white h-16 px-3">
        <div class="col-span-2">{{ p.name }}</div>
        <div>{{ p.validity }}</div>
        <div>{{ p.oa_status.label }}</div>

        <div class="flex flex-col items-start">
            <button id="b_edit_{{ p.id }}" class="flex items-center text-center font-medium text-blue-600 hover:underline" onclick="setDialogValues({{ p.toJson() }} )"><span class="icon-[heroicons--pencil] mr-2"></span>{{ _("Bearbeiten") }}</button>
            {% if p.is_doaj == 0 %}
            <button class="flex items-center text-center font-medium text-green-700 hover:underline" onclick="copy_publisher({{ p.id }})"><span class="icon-[heroicons--clipboard-document] mr-2"></span>{{ _("Kopieren") }}</button>
            <button class="flex items-center text-center font-medium text-red-700 hover:underline" onclick="delete_publisher({{ p.id }})"><span class="icon-[heroicons--trash] mr-2"></span>{{ _("Löschen") }}</button>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>

{# modal #}
<div id="publisher-modal" tabindex="-1" class="fixed top-0 left-0 right-0 z-50 hidden w-full p-4 overflow-x-scroll overflow-y-scroll md:inset-0 md:h-full">
    <div class="relative w-full h-full">
        <div class="relative bg-white rounded-lg shadow-sm">
            <button type="button" onclick="hideModal();" class="absolute top-3 right-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center">
                <span class="w-5 h-5 icon-[ep--close]"></span>
                <span class="sr-only">{{ _('Schließen') }}</span>
            </button>
            <div class="px-6 py-6 lg:px-8">
                <form class="space-y-6" action="/admin_save_publisher" method="post">
                <div class="mb-4 border-b border-gray-200">
                    <ul class="flex flex-wrap -mb-px text-sm font-medium text-center">
                        <li class="tab mr-2" role="presentation">
                            <button id="tab1" class="inline-block p-4 border-b-2 rounded-t-lg hover:text-gray-600 hover:border-gray-300" type="button">Common</button>
                        </li>
                        <li class="tab mr-2" role="presentation">
                            <button id="tab2" class="inline-block p-4 border-b-2 rounded-t-lg  hover:text-gray-600 hover:border-gray-300" type="button">German</button>
                        </li>
                        <li class="tab mr-2" role="presentation">
                            <button id="tab3" class="inline-block p-4 border-b-2 rounded-t-lg hover:text-gray-600 hover:border-gray-300" type="button">English</button>
                        </li>
                        <li class="tab mr-2" role="presentation">
                            <button id="tab4" class="inline-block p-4 border-b-2 rounded-t-lg hover:text-gray-600 hover:border-gray-300" type="button">Links</button>
                        </li>
                    </ul>
                </div>
                <div>
                    <div id="tab1C" class="tab-container p-4 rounded-lg bg-gray-50">
                        <div>
                            <label for="dlg_p_id" class="hidden mb-2 text-sm font-medium text-gray-900">{{ _("Id") }}</label>
                            <input type="text" name="id" id="dlg_p_id" class="hidden bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5    " required>
                        </div>
                        <div>
                        <label for="dlg_p_name" class="block mb-2 text-sm font-medium text-gray-900">{{ _("Name") }}</label>
                        <input type="text" name="name" id="dlg_p_name" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5    " required>
                        </div>
                        <div>
                        <label for="dlg_p_validity" class="block mb-2 text-sm font-medium text-gray-900">{{ _("Vertragslaufzeit") }}</label>
                        <input type="text" name="validity" id="dlg_p_validity" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5    " required>
                        </div>
                        <div>
                            <label for="dlg_p_oa_status" class="block mb-2 text-sm font-medium text-gray-900">{{ _("OA-Status") }}</label>
                            <select name="oa_status" id="dlg_p_oa_status" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5      " required>
                                {% for key,oa in OA_STATUS.items() %}
                                <option value="{{ key }}">{{ oa.label }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div>
                            <label for="dlg_p_application_requirement" class="block mb-2 text-sm font-medium text-gray-900">{{ _("Antrag erforderlich") }}</label>
                            <select name="application_requirement" id="dlg_p_application_requirement" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5      " required>
                                {% for key,ar in APPLICATION_REQUIREMENT.items() %}
                                <option value="{{ key }}">{{ ar.label }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="hidden">
                            <label for="dlg_p_is_doaj" class="mb-2 text-sm font-medium text-gray-900">{{ _("DOAJ") }}</label>
                            <input type="checkbox" name="is_doaj" id="dlg_p_is_doaj" class="ml-2 bg-gray-50 border border-gray-300 text-gray-900 text-focus:ring-blue-500 focus:border-blue-500">
                        </div>                        
                        <div id="div_doaj_linked" class="flex mt-2">
                            <label for="dlg_p_doaj_linked" class="text-sm font-medium text-gray-900">{{ _("DOAJ-verknüpft") }}</label>
                            <input type="checkbox" name="doaj_linked" id="dlg_p_doaj_linked" class="ml-2 bg-gray-50 border border-gray-300 text-gray-900 text-focus:ring-blue-500 focus:border-blue-500">
                        </div>                        
                    </div>
                    <div id="tab2C" hidden class="tab-container p-4 rounded-lg bg-gray-50">
                        <div>
                            <label for="dlg_p_valid_tu" class="block mb-2 text-sm font-medium text-gray-900">{{ _("Gültig für") }}</label>
                            <input type="text" name="valid_tu" id="dlg_p_valid_tu" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                        </div>
                        <div>
                            <label for="dlg_p_cost_coverage" class="block mb-2 text-sm font-medium text-gray-900">{{ _("Kostenübernahme") }}</label>
                            <input type="text" name="cost_coverage" id="dlg_p_cost_coverage" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                        </div>
                        <div>
                            <label for="dlg_p_funder_info" class="block mb-2 text-sm font-medium text-gray-900">{{ _("Ablauf") }}</label>
                            <textarea rows="10" cols="200" name="funder_info" id="dlg_p_funder_info" class="max-w-full w-auto h-auto overflow-x-auto overflow-y-auto resize-none bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5"></textarea>
                        </div>
                        <div>
                            <label for="dlg_p_further_info" class="block mb-2 text-sm font-medium text-gray-900">{{ _("Sonderbestimmungen FWF") }}</label>
                            <textarea rows="10" cols="200" name="further_info" id="dlg_p_further_info" class="max-w-full w-auto h-auto overflow-x-auto overflow-y-auto resize-none bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5"></textarea>
                        </div>
                        <div>
                            <label for="dlg_p_article_type" class="block mb-2 text-sm font-medium text-gray-900">{{ _("Artikeltyp") }}</label>
                            <input type="text" name="article_type" id="dlg_p_article_type" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                        </div>
                    </div>
                    <div id="tab3C" hidden class="tab-container p-4 rounded-lg bg-gray-50">
                        <div>
                            <label for="dlg_p_valid_tu_en" class="block mb-2 text-sm font-medium text-gray-900">{{ _("Gültig für") }}</label>
                            <input type="text" name="valid_tu_en" id="dlg_p_valid_tu_en" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                        </div>
                        <div>
                            <label for="dlg_p_cost_coverage_en" class="block mb-2 text-sm font-medium text-gray-900">{{ _("Kostenübernahme") }}</label>
                            <input type="text" name="cost_coverage_en" id="dlg_p_cost_coverage_en" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                        </div>
                        <div>
                            <label for="dlg_p_funder_info_en" class="block mb-2 text-sm font-medium text-gray-900">{{ _("Ablauf") }}</label>
                            <textarea rows="10" cols="200" name="funder_info_en" id="dlg_p_funder_info_en" class="max-w-full w-auto h-auto overflow-x-auto overflow-y-auto resize-none bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5"></textarea>
                        </div>
                        <div>
                            <label for="dlg_p_further_info_en" class="block mb-2 text-sm font-medium text-gray-900">{{ _("Sonderbestimmungen FWF") }}</label>
                            <textarea rows="10" cols="200" name="further_info_en" id="dlg_p_further_info_en" class="max-w-full w-auto h-auto overflow-x-auto overflow-y-auto resize-none bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5"></textarea>
                        </div>
                        <div>
                            <label for="dlg_p_article_type_en" class="block mb-2 text-sm font-medium text-gray-900">{{ _("Artikeltyp") }}</label>
                            <input type="text" name="article_type_en" id="dlg_p_article_type_en" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                        </div>
                    </div>
                    <div id="tab4C" hidden class="tab-container p-4 rounded-lg bg-gray-50">
                        <input type="button" value="{{ _("Neuer Link") }}"" onclick="addLink(null,null);" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-hidden focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center   "/>
                        <div id="dlg_p_links"></div> 
                    </div>                                              
                </div>
                <button type="submit" class="w-full text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-hidden focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center">Speichern</button>
                </form>
            </div>
        </div>
    </div>
</div>

{# template for links #}
<div id='linktype_template' class="hidden">
    <label for="dlg_p_linktype_id_linktype" class="block mb-2 text-sm font-medium text-gray-900">{{ _("Linktyp") }}</label>
    <select name="links_linktype[]" id="dlg_p_linktype_id_linktype" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" required>
        <option disabled selected value>{{ _('&lt;Linktyp wählen&gt;') }}</option>
        {% for key,linktype in LINKTYPE.items() %}
        <option value="{{ key }}">{{ linktype.label }}</option>
        {% endfor %}
    </select>
</div>


{% endblock content %}
{% block additional %}
<script>
    $(document).ready(function() 
    {
        $('.tab button').click(function()
        {
            var t = $(this).attr('id');
            $('.tab-container').attr('hidden',true);
            $('#'+ t + 'C').removeAttr('hidden');
        })
    });

    function hideModal() { $('#publisher-modal').hide(); }
    function showModal() { $('#publisher-modal').show(); }

    function setDialogValues(p)
    {
        showModal();

        var x;
        if (p == null)
        {
            p={id:-1};
        }

        x=document.getElementById('dlg_p_id')
        x.value=p.id 
        x.placeholder=p.id;

        x=document.getElementById('dlg_p_name');        
        x.value=(p.name) ? p.name : '';
        x.placeholder=(p.name) ? p.name : "{{ _('Name') }}";

        x=document.getElementById('dlg_p_validity');        
        x.value=(p.validity) ? p.validity : '';
        x.placeholder=(p.validity) ? p.validity : "{{ _('Gültigkeit') }}";

        x=document.getElementById('dlg_p_oa_status');    
        x.selectedIndex=-1;
        options=x.getElementsByTagName('option');
        for (i=0;i<options.length;++i)
        {
            option=options[i];
            val=option.getAttribute('value');
            if (val==p.oa_status)
            {
                option.selected=true;
            }
        }

        x=document.getElementById('dlg_p_application_requirement');    
        x.selectedIndex=-1;
        options=x.getElementsByTagName('option');
        for (i=0;i<options.length;++i)
        {
            option=options[i];
            val=option.getAttribute('value');
            if (val==p.application_requirement)
            {
                option.selected=true;
            }
        }

        x=document.getElementById('dlg_p_funder_info');        
        x.value=(p.funder_info) ? p.funder_info : '';
        x.placeholder=(p.funder_info) ? p.funder_info : "{{ _('Ablauf') }}";

        x=document.getElementById('dlg_p_funder_info_en');        
        x.value=(p.funder_info_en) ? p.funder_info_en : '';
        x.placeholder=(p.funder_info_en) ? p.funder_info_en : "{{ _('Ablauf en') }}";

        x=document.getElementById('dlg_p_cost_coverage');        
        x.value=(p.cost_coverage) ? p.cost_coverage : '';
        x.placeholder=(p.cost_coverage) ? p.cost_coverage : "{{ _('Kostenübernahme') }}";

        x=document.getElementById('dlg_p_cost_coverage_en');        
        x.value=(p.cost_coverage_en) ? p.cost_coverage_en : '';
        x.placeholder=(p.cost_coverage_en) ? p.cost_coverage_en : "{{ _('Kostenübernahme en') }}";

        x=document.getElementById('dlg_p_valid_tu');
        x.value=(p.valid_tu) ? p.valid_tu : '';
        x.placeholder=(p.valid_tu) ? p.valid_tu : "{{ _('Gültig für') }}";

        x=document.getElementById('dlg_p_valid_tu_en');        
        x.value=(p.valid_tu_en) ? p.valid_tu_en : '';
        x.placeholder=(p.valid_tu_en) ? p.valid_tu_en : "{{ _('Gültig für en') }}";

        x=document.getElementById('dlg_p_article_type');        
        x.value=(p.article_type) ? p.article_type : '';
        x.placeholder=(p.article_type) ? p.article_type : "{{ _('Artikeltyp') }}";

        x=document.getElementById('dlg_p_article_type_en');        
        x.value=(p.article_type_en) ? p.article_type_en : '';
        x.placeholder=(p.article_type_en) ? p.article_type_en : "{{ _('Artikeltyp en') }}";

        x=document.getElementById('dlg_p_further_info');        
        x.value=(p.further_info) ? p.further_info : '';
        x.placeholder=(p.further_info) ? p.further_info : "{{ _('Sonderbestimmungen FWF') }}";

        x=document.getElementById('dlg_p_further_info_en');        
        x.value=(p.further_info_en) ? p.further_info_en : '';
        x.placeholder=(p.further_info_en) ? p.further_info_en : "{{ _('Sonderbestimmungen FWF en') }}";

        x=document.getElementById('dlg_p_is_doaj');        
        x.checked=(p.is_doaj == 1) ? true : false;

        if (p.is_doaj == 1)
        {
            x=document.getElementById('div_doaj_linked');
            x.style.display='none';
        }
        else
        {
            x=document.getElementById('div_doaj_linked');
            x.style.display='flex';
            x=document.getElementById('dlg_p_doaj_linked');        
            x.checked=(p.doaj_linked == 1) ? true : false;
        }
        removeAllLinks();
        if (p.links)
        {
            for (i=0;i<p.links.length;++i)
            {
                link=p.links[i]
                addLink(i,link);
            }
        }
    }

    function delete_publisher(id) 
    {
        if (confirm("{{ _('Es werden auch alle Zeitschriften und Excel-Dateien gelöscht, die mit diesem Verlag verknüpft sind. Möchten Sie fortsetzen?') }}")) 
        {
            url = {{ url_for("admin_delete_publisher")|tojson }};
            form = $('<form>', {
                    'action': url,
                    'method': 'post'
            });
            form.append($('<input>', {
                'name': 'id',
                'value': id
            }));
            form.appendTo('body');
            form.submit();
        }
    }

    function copy_publisher(id) 
    {
        url = {{ url_for("admin_copy_publisher")|tojson }};
        form = $('<form>', {
                    'action': url,
                    'method': 'post'
        });
        form.append($('<input>', {
            'name': 'id',
            'value': id
        }));
        form.appendTo('body');
        form.submit();
    }

    function getNextLinkId()
    {
        x=document.getElementById('dlg_p_links');
        containers=x.getElementsByTagName('div');
        max=0;
        idfound=false;
        for (i=0;i<containers.length;++i)
        {
            container=containers[i]
            id=container.getAttribute('id');
            if (id)
            {
                re=/container-link-([0-9]+)/;
                match=id.match(re);
                if (match)
                {
                    idfound=true;
                    val=match[1];
                    val=val*1;
                    
                    if (val>max)
                    {
                        max=val;
                    }
                }
            }
        }
        if (idfound) { ++max; }
        return max;
    }

    function addLink(id,link)
    {   
        if (! id) 
        { 
            id=getNextLinkId();
        }

        x=document.getElementById('dlg_p_links');

        container=document.createElement('div');
        container.setAttribute('id','container-link-'+id);
        container.setAttribute('class','mt-4 border-solid border-2 border-gray-600');

        div=document.createElement('div');
        input=document.createElement('input');
        input.setAttribute('type','text');
        input.setAttribute('name','links_id[]');
        input.setAttribute('class','hidden bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5    ');
        input.value=(link && link.id) ? link.id : '';
        input.placeholder=(link && link.id) ? link.id : '{{ _("Id") }}';
        div.appendChild(input);
        container.appendChild(div);

        div=document.createElement('div');
        label=document.createElement('label')
        label.setAttribute('for','dlg_p_link_' + id +'_link');
        label.setAttribute('class','class="block mb-2 text-sm font-medium text-gray-900 ');
        label.textContent='{{ _("URL") }}'
        div.appendChild(label);
        input=document.createElement('input');
        input.setAttribute('type','text');
        input.setAttribute('name','links_link[]');
        input.setAttribute('id','dlg_p_link_' + id +'_link');
        input.setAttribute('class','bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5    ');
        input.value=(link && link.link) ? link.link : '';
        input.placeholder=(link && link.link) ? link.link : '{{ _("URL") }}';
        div.appendChild(input);
        container.appendChild(div);

        var div = $("#linktype_template").clone();
        div.toggleClass('hidden');
        div.removeAttr("id");
        div.children("label").attr('for','dlg_p_linktype_'+id+'_linktype');
        var select = div.children('select').attr('id','dlg_p_linktype_'+id+'_linktype');
        if (link && link.id)
        {
            select.children('option').attr('selected',false);
            select.children('option[value="' + link.linktype + '"]').attr('selected',true);
        }
        container.appendChild(div[0]);


        div=document.createElement('div');
        label=document.createElement('label')
        label.setAttribute('for','dlg_p_link_' + id +'_linktext_de');
        label.setAttribute('class','class="block mb-2 text-sm font-medium text-gray-900 ');
        label.textContent='{{ _("Linktext de") }}'
        div.appendChild(label);
        input=document.createElement('input');
        input.setAttribute('type','text');
        input.setAttribute('name','links_linktext_de[]');
        input.setAttribute('id','dlg_p_link_' + id +'_linktext_de');
        input.setAttribute('class','bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5    ');
        input.value=(link && link.linktext_de) ? link.linktext_de : '';
        input.placeholder=(link && link.linktext_de) ? link.linktext_de : '{{ _("Linktext de") }}';
        div.appendChild(input);
        container.appendChild(div);

        div=document.createElement('div');
        label=document.createElement('label')
        label.setAttribute('for','dlg_p_link_' + id +'_linktext_en');
        label.setAttribute('class','class="block mb-2 text-sm font-medium text-gray-900 ');
        label.textContent='{{ _("Linktext en") }}'
        div.appendChild(label);
        input=document.createElement('input');
        input.setAttribute('type','text');
        input.setAttribute('name','links_linktext_en[]');
        input.setAttribute('id','dlg_p_link_' + id +'_linktext_en');
        input.setAttribute('class','bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5    ');
        input.value=(link && link.linktext_en) ? link.linktext_en : '';
        input.placeholder=(link && link.linktext_en) ? link.linktext_en : '{{ _("Linktext en") }}';
        div.appendChild(input);

        input=document.createElement('input');
        input.setAttribute('type','button');
        input.setAttribute('onclick','removeLink('+id+')');
        input.setAttribute('class','text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-hidden focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center   ');        
        input.value='{{ _("Link löschen") }}';
        div.appendChild(input);
        
        container.appendChild(div);

        x.appendChild(container);
    }

    function removeLink(id) 
    {
        id='container-link-'+id;
        x=document.getElementById('dlg_p_links');
        containers=x.getElementsByTagName('div');
        l=[];
        for (i=0;i<containers.length;++i)
        {
            container=containers[i];
            if (id==container.getAttribute('id'))
            {
                l.push(container);
            }
        }
        for (i=0;i<l.length;++i)
        {
            e=l[i];
            e.remove();
        }
    }

    function removeAllLinks()
    {
        x=document.getElementById('dlg_p_links');
        containers=x.getElementsByTagName('div');
        l=[];
        for (i=0;i<containers.length;++i)
        {
            container=containers[i];
            id=container.getAttribute('id');
            if (id)
            {
                re=/container-link-([0-9]+)/;
                match=id.match(re);
                if (match)
                {
                    l.push(container);
                }
            }
        }
        for (i=0;i<l.length;++i)
        {
            e=l[i];
            e.remove();
        }
    }
</script>
{% endblock additional %}
  
